function Venue(a,b){"use strict";var c=this;c.parent=a,c.fs=b,c.photoURLs=ko.observableArray(),c.photoURLs.extend({rateLimit:50}),c.Latlng=new google.maps.LatLng(c.fs.location.lat,c.fs.location.lng),c.marker=new google.maps.Marker({position:c.Latlng,map:map}),google.maps.event.addListener(c.marker,"click",function(){a.click(c)}),c.isVisible=ko.computed(function(){var b=new RegExp(a.search(),"i");return c.fs.name.match(b)?(c.marker.setVisible(!0),!0):(a.selectedVenue===c&&a.infowindow.close(),c.marker.setVisible(!1),!1)}),c.getPhotoURIs=function(){var a=FS_BASE_VENUES_API+c.fs.id+"/photos?"+FS_CLIENT_ID_SECRET_VERSION;$.getJSON(a).done(function(a){a.response.photos.items.forEach(function(a){c.photoURLs().push(a.prefix+"200x200"+a.suffix)})}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)})}}function ViewModel(){"use strict";var a=this;if(a.venues=ko.observableArray(),a.venues.extend({rateLimit:50}),a.search=ko.observable(),a.selectedVenue=ko.observable(),a.venueListVisible=ko.observable(!0),window.google){var b={center:{lat:51.50987715506726,lng:-.12937564602657403},zoom:15,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("map-canvas"),b);var c=new google.maps.TransitLayer;c.setMap(map),a.infowindow=new google.maps.InfoWindow,$.getJSON(FS_VENUES_SEARCH).done(function(b){var c=new google.maps.LatLngBounds;b.response.venues.forEach(function(b){var d=new Venue(a,b);a.venues.push(d),google.maps.event.addDomListener(window,"load",d.getPhotoURIs),c.extend(d.Latlng)}),map.fitBounds(c)}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d)})}else $("#map-canvas").html("<h1> Google Maps Not Responding</h1>"),$("#venue-col").hide();a.click=function(b){a.selectedVenue=b,b.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){b.marker.setAnimation(null)},2100);var c='<div id="ib"><h3>'+b.fs.name+"</h3>";b.fs.location.formattedAddress.forEach(function(a){c+="<p>"+a+"<p>"});var d=b.photoURLs().length;d&&(c+='<img src="x'+b.photoURLs()[Math.floor(Math.random()*d)]+'" height="200" width="200" onerror="this.onerror=null;this.height=0;" >'),c+="</div>",a.infowindow.setContent(c),a.infowindow.open(map,b.marker);var e=$("#ib").offset(),f=$(window).height(),g=$(window).width(),h=$("#ib").outerHeight(),i=$("#ib").outerWidth(),j=e.top-(f-h)/2,k=e.left-(g-i)/2;map.panBy(k,j),768>g&&a.venueListVisible(!1)},a.toggleVenueList=function(){a.venueListVisible(!a.venueListVisible())}}var FS_BASE_VENUES_API="https://api.foursquare.com/v2/venues/",FS_CLIENT_ID="client_id=XFK55MNUHZ4NT0ULP2TKZGAQOWE1ACMOJQGJSWJF3E1UU4TE%20%20",FS_CLIENT_SECRET="client_secret=XABTOZ2CJG3KJR40XTCMQT4Z2MA0ICMZWNHCUYFFYZOEZMRJ%20%20",FS_API_VERSION="v=20150708%20%20",FS_CLIENT_ID_SECRET_VERSION=FS_CLIENT_ID+"&"+FS_CLIENT_SECRET+"&"+FS_API_VERSION,FS_VENUES_SEARCH=FS_BASE_VENUES_API+"search?"+FS_CLIENT_ID_SECRET_VERSION+"&ll=51.511222%2C-0.133812&radius=1000&intent=browse&categoryId=4d4b7104d754a06370d81259",map;$(document).ready(function(){$(".list-group").css("max-height",.85*$(window).height()),ko.applyBindings(new ViewModel)});