function Venue(a,b){var c=this;c.parent=a,c.fs=b,c.photoURLs=ko.observableArray(),c.photoURLs.extend({rateLimit:50}),c.Latlng=new google.maps.LatLng(c.fs.location.lat,c.fs.location.lng),c.marker=new google.maps.Marker({position:c.Latlng,map:map}),google.maps.event.addListener(c.marker,"click",function(){a.click(c)}),c.isVisible=ko.computed(function(){var b=new RegExp(a.search(),"i");return c.fs.name.match(b)?(c.marker.setVisible(!0),!0):(a.selectedVenue===c&&a.infowindow.close(),c.marker.setVisible(!1),!1)}),c.getPhotoURIs=function(){var a=FS_BASE_VENUES_API+c.fs.id+"/photos?"+FS_CLIENT_ID_SECRET_VERSION;$.getJSON(a).done(c.getPhotosInfoDone).done(function(a){for(var b=0,d=a.response.photos.items.length;d>b;b++){var e=a.response.photos.items[b];c.photoURLs().push(e.prefix+"200x200"+e.suffix)}}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d),alert("FourSquare is not responding to our request")})}}function ViewModel(){var a=this;a.venues=ko.observableArray(),a.venues.extend({rateLimit:50}),a.search=ko.observable(),a.selectedVenue=ko.observable(),a.venueListVisible=ko.observable(!0),map=new google.maps.Map(document.getElementById("map-canvas"),mapOptions);var b=new google.maps.TransitLayer;b.setMap(map),a.infowindow=new google.maps.InfoWindow,$.getJSON(FS_VENUES_SEARCH).done(function(b){console.log(b);for(var c=0,d=b.response.venues.length;d>c;c++){var e=b.response.venues[c],f=new Venue(a,e);a.venues.push(f),google.maps.event.addDomListener(window,"load",f.getPhotoURIs)}}).fail(function(a,b,c){var d=b+", "+c;console.log("Request Failed: "+d),alert("FourSquare is not responding to our request")}),a.click=function(b){a.selectedVenue=b,b.marker.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){b.marker.setAnimation(null)},2100);for(var c='<div id="ib"><h3>'+b.fs.name+"</h3>",d=0,e=b.fs.location.formattedAddress.length;e>d;d++){var f=b.fs.location.formattedAddress[d];c+="<p>"+f+"<p>"}var g=b.photoURLs().length;g&&(c+='<img src="'+b.photoURLs()[Math.floor(Math.random()*g)]+'">"'),c+="</div>",a.infowindow.setContent(c),a.infowindow.open(map,b.marker);var h=$("#ib").offset(),i=$(window).height(),j=$(window).width(),k=$("#ib").outerHeight(),l=$("#ib").outerWidth(),m=h.top-(i-k)/2,n=h.left-(j-l)/2;map.panBy(n,m),768>j&&a.venueListVisible(!1)},a.toggleVenueList=function(){a.venueListVisible(!a.venueListVisible())}}var FS_BASE_VENUES_API="https://api.foursquare.com/v2/venues/",FS_CLIENT_ID="client_id=XFK55MNUHZ4NT0ULP2TKZGAQOWE1ACMOJQGJSWJF3E1UU4TE%20%20",FS_CLIENT_SECRET="client_secret=XABTOZ2CJG3KJR40XTCMQT4Z2MA0ICMZWNHCUYFFYZOEZMRJ%20%20",FS_API_VERSION="v=20150708%20%20",FS_CLIENT_ID_SECRET_VERSION=FS_CLIENT_ID+"&"+FS_CLIENT_SECRET+"&"+FS_API_VERSION,FS_VENUES_SEARCH=FS_BASE_VENUES_API+"search?"+FS_CLIENT_ID_SECRET_VERSION+"&ll=51.511222%2C-0.133812&radius=1000&intent=browse&categoryId=4d4b7104d754a06370d81259",map,mapOptions={center:{lat:51.50987715506726,lng:-.12937564602657403},zoom:15,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};$(document).ready(function(){$("#venue-list").css("max-height",.85*$(window).height())});var viewModel=new ViewModel;ko.applyBindings(viewModel);